# Image and video annotation tools for object detection and tracking

Object annotation in images in [YOLO](https://github.com/pjreddie/darknet) format.

Interactively edit or preview object tracking data generated by automatic trackers such as [SORT](https://github.com/abewley/sort). 


## Table of contents

- [Quick start](#quick-start)
- [Prerequisites](#prerequisites)
- [Usage](#usage)
- [GUI usage](#gui-usage)
- [Authors](#authors)

## Quick start

To use annotation tools, clone the repo:

```
git clone https://github.com/mipp/annotation-tools
```

### Prerequisites

You need to install:

- [Python](https://www.python.org/downloads/)
- [OpenCV](https://opencv.org/)
    1. `python -mpip install -U pip`
    1. `python -mpip install -U opencv-contrib-python`


## Image annotation usage
Running the tool:

  1. Put all images to be annotated in a directory
  2. Put existing annotations in YOLO format in a directory (if they exist)
  3. Prepare a file listing object classes (each class in new line)
  4. Create a directory for new annotations
  4. Run the command:

         python annotate_objects.py [-h] [--img_dir IMG_DIR] [--txt_dir TXT_DIR] [--names NAMES]
                           [--output OUTPUT] [--data DATA]

            arguments:
            -h, --help         show this help message and exit
            --img_dir IMG_DIR  directory contatining images to annotate
            --txt_dir TXT_DIR  existing annotations directory
            --names NAMES      class names file (each class in new line)
            --output OUTPUT    directory to save new/changed annotations.
            --data DATA        (optional) yolo .data file to read classes from.

The tool displays the current filename and selected class in the window header. The selected class will be the class for the new bounding box annotation. The main windows shows the image with bounding box annotations and classes. **The edited annotations are automatically saved in directory given by --output parameter.**

#### GUI usage

| Keys:    |                              |
|----------|------------------------------|
| o/p      | previous/next image          |
| k/l      | previous/next class label.   |
| n        | new bounding box             |
| backspace| delete selected bounding box |
| Esc      | exit program.                |

**Mouse:**

When no box is selected:
- Left click within bounding box: select bounding box.

When a box is selected:
- Redraw a new box by left clicking two opposite corners of desired bouding box.

When drawing new box (keyboard n was pressed):
- Draw a new box by left clicking two opposite corners of desired bouding box.

Right click within selected bounding box:
- Edit ID of clicked box. Enter new id and press ENTER. Edited box is shown with orange border.

Right click within another bounding box: 
- swap IDs of clicked box with previously selected box.


## Tracking annotation usage

To run the tool, run the command:


    python annotate_tracking.py [-h] [--tracker TRACKER] input video

    Edit and preview object tracking data.

    positional arguments:
    input              tracking data (MOT challenge data format text file output by e.g. SORT tracker)
    video              path to video file.

    optional arguments:
    -h, --help         show this help message and exit
    --tracker TRACKER  input format: ds - Deep SORT tracker (default), sort - SORT tracker

The tool displays the filename and current frame index in the window header. The main windows shows the image with bounding box annotations and track IDs. You can move forward/backward through the video using o/p keys, and check and edit swapped track IDs.

### GUI usage

| Keys |                            |
|------|----------------------------|
| o/p  | previous/next frame        |
| g    | jump to specific frame     |
| s    | save changes               |
| r    | revert to last saved       |
| R    | redo changes (undo revert) |

**Mouse:**

Left click within bounding box:
- Select bounding box or cycle selection if multiple boxes overlap region.
- Selected box is shown with white border.

Left click outside bounding box: 
- deselect.

Right click within selected bounding box: 
- Edit ID of clicked box. Enter new id and press ENTER. 
- Edited box is shown with orange border.

Right click within another bounding box: 
- swap IDs of clicked box with previously selected box.

